<!doctype html> 
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Start — TinyTeam</title>
  <meta name="description" content="Start your TinyTeam library. Submit the form to begin processing." />

  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --border:rgba(0,0,0,.10);
      --brand:#2563eb;
      --brand2:#111827;
      --radius:16px;
    }

    *{box-sizing:border-box}
    body{
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Helvetica Neue", Helvetica;
      background:var(--bg);
      margin:0;
      padding:24px;
      color:var(--text);
    }
    .card{
      max-width:980px;
      margin:0 auto;
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:22px;
      box-shadow:0 10px 24px rgba(0,0,0,.06);
    }
    .top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:18px;
      flex-wrap:wrap;
      margin-bottom:10px;
    }
    h2{margin:0 0 6px;font-size:22px}
    .sub{margin:0;color:var(--muted);line-height:1.35}
    .badge{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      color:var(--muted);
      background:#fff;
      white-space:nowrap;
    }
    .divider{height:1px;background:rgba(0,0,0,.06);margin:16px 0}

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-top:12px;
    }
    .btn{
      display:inline-block;
      padding:12px 14px;
      border-radius:12px;
      background:var(--brand2);
      color:#fff;
      text-decoration:none;
      font-weight:750;
      font-size:14px;
      border:0;
      cursor:pointer;
    }
    .btn.secondary{
      background:#fff;
      color:var(--brand2);
      border:1px solid var(--border);
      font-weight:800;
    }

    /* form */
    .formWrap{
      border:1px solid rgba(0,0,0,.10);
      border-radius:16px;
      overflow:hidden;
      background:#fff;
      padding:16px;
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    .row{display:flex;flex-direction:column;gap:6px}
    label{font-size:13px;color:var(--muted);font-weight:700}
    input, select, textarea{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid rgba(0,0,0,.15);
      font-size:14px;
      outline:none;
      background:#fff;
    }
    textarea{min-height:110px;resize:vertical}
    .full{grid-column: 1 / -1}
    .hint{font-size:12.5px;color:var(--muted);line-height:1.35;margin:10px 0 0}
    .mini{font-size:12.5px;color:var(--muted);margin-top:14px;line-height:1.35}
    .mini strong{color:var(--text)}
    .status{
      margin-top:10px;
      font-size:13px;
      color:var(--muted);
      line-height:1.4;
      display:none;
    }
    .status.show{display:block}
    @media (max-width: 780px){
      .grid{grid-template-columns:1fr}
    }
  </style>
</head>

<body>
  <div class="card">
    <div class="top">
      <div>
        <h2>Start Your Library</h2>
        <p class="sub">
          Submit the form below to start your TinyTeam library. After review, you’ll receive your next-step instructions by email.
        </p>
      </div>
      <div class="badge">Auto Design Enabled ✅</div>
    </div>

    <div class="divider"></div>

    <div class="formWrap">
      <form id="startForm" novalidate>
        <div class="grid">
          <div class="row">
            <label for="ownerName">Owner Name *</label>
            <input id="ownerName" name="ownerName" type="text" placeholder="Full name" required />
          </div>

          <div class="row">
            <label for="ownerEmail">Owner Email *</label>
            <input id="ownerEmail" name="ownerEmail" type="email" placeholder="you@email.com" required />
          </div>

          <div class="row full">
            <label for="libraryTitle">Library Title *</label>
            <input id="libraryTitle" name="libraryTitle" type="text" placeholder="Example: The Santos Family Library" required />
          </div>

          <div class="row">
            <label for="package">Package</label>
            <select id="package" name="package">
              <option value="FAM">Family Library (FAM)</option>
              <option value="COMM">Community Library (COMM)</option>
              <option value="ADDON">Photo / Docs Add-On</option>
            </select>
          </div>

          <!-- ✅ ADDED (minimal): 6 Auto Design choices -->
          <div class="row">
            <label for="designTemplate">Auto Design (choose 1)</label>
            <select id="designTemplate" name="designTemplate">
              <option value="">Auto (recommended)</option>
              <option value="DESIGN_01">Design 01</option>
              <option value="DESIGN_02">Design 02</option>
              <option value="DESIGN_03">Design 03</option>
              <option value="DESIGN_04">Design 04</option>
              <option value="DESIGN_05">Design 05</option>
              <option value="DESIGN_06">Design 06</option>
            </select>
          </div>

          <div class="row">
            <label for="theme">Theme Style</label>
            <select id="theme" name="theme">
              <option value="">Auto (recommended)</option>
              <option value="Classic">Classic</option>
              <option value="Modern">Modern</option>
              <option value="Minimal">Minimal</option>
              <option value="Warm">Warm</option>
              <option value="Elegant">Elegant</option>
            </select>
          </div>

          <div class="row">
            <label for="primaryColor">Color Mood</label>
            <select id="primaryColor" name="primaryColor">
              <option value="">Auto (recommended)</option>
              <option value="#2563eb">Blue</option>
              <option value="#16a34a">Green</option>
              <option value="#111827">Neutral (Black/Gray)</option>
              <option value="#a855f7">Purple</option>
              <option value="#f59e0b">Warm (Gold)</option>
              <option value="#0ea5e9">Sky</option>
            </select>
          </div>

          <!-- ✅ ADDED (minimal): Family intro / history page text -->
          <div class="row full">
            <label for="familyIntro">Family Introduction / History (optional)</label>
            <textarea id="familyIntro" name="familyIntro" placeholder="Write a short introduction you want included in the library (history, story, dedication, etc.)"></textarea>
          </div>

          <div class="row full">
            <label for="notes">Notes (optional)</label>
            <textarea id="notes" name="notes" placeholder="Anything you want us to know (names, dates, preferences, etc.)"></textarea>
          </div>
        </div>

        <p class="hint">
          <strong>Not sure?</strong> Leave Auto Design, Theme Style, and Color Mood on <strong>Auto (recommended)</strong> — we’ll handle the design for you.
        </p>

        <div class="actions">
          <button class="btn" id="submitBtn" type="submit">Submit Request</button>
          <a class="btn secondary" id="payBtn" href="payment.html">Proceed to Payment</a>
        </div>

        <div class="status" id="statusBox"></div>
      </form>
    </div>

    <p class="mini">
      <strong>Privacy note:</strong> Your submission is handled internally by TinyTeam for processing and delivery.
    </p>
  </div>

  <script>
    // ✅ Apps Script Web App (bridge)
    const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbzrMDP8Z6jzy-3WJKSe7TLEMhRCLl9WIKvmNTLtjgR7MSm2vhKrDOtRRxmkynnu_HETSw/exec";

    // Auto-Design Option 1 defaults (front-end safety)
    const DEFAULT_THEME = "Auto";
    const DEFAULT_PRIMARY_COLOR = "#2563eb";
    const DEFAULT_DESIGN_TEMPLATE = ""; // Auto (recommended)

    // keep the selected package in the payment page when start.html is opened like:
    // start.html?package=FAM  or  start.html?package=COMM
    (function () {
      const params = new URLSearchParams(window.location.search);
      const pkg = (params.get("package") || "").toUpperCase();
      if (!pkg) return;

      const payBtn = document.getElementById("payBtn");
      if (payBtn) payBtn.href = `payment.html?package=${encodeURIComponent(pkg)}`;

      const pkgSel = document.getElementById("package");
      if (pkgSel && (pkg === "FAM" || pkg === "COMM" || pkg === "ADDON")) pkgSel.value = pkg;
    })(); /* ✅ FIX: this closing was missing */

    // keep "Proceed to Payment" synced with current package selection
(function () {
  const payBtn = document.getElementById("payBtn");
  const pkgSel = document.getElementById("package");
  if (!payBtn || !pkgSel) return;

  function syncPayLink() {
    const v = (pkgSel.value || "FAM").toUpperCase();
    payBtn.href = `payment.html?package=${encodeURIComponent(v)}`;
  }

  pkgSel.addEventListener("change", syncPayLink);
  syncPayLink();
})();


    const form = document.getElementById("startForm");
    const submitBtn = document.getElementById("submitBtn");
    const statusBox = document.getElementById("statusBox");

    function setStatus(msg) {
      statusBox.textContent = msg;
      statusBox.classList.add("show");
    }

    function toFormBody(data) {
      const p = new URLSearchParams();
      Object.keys(data).forEach(k => p.append(k, data[k]));
      return p.toString();
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const ownerName = (document.getElementById("ownerName").value || "").trim();
      const ownerEmail = (document.getElementById("ownerEmail").value || "").trim();
      const libraryTitle = (document.getElementById("libraryTitle").value || "").trim();
      const pkg = (document.getElementById("package").value || "FAM").toUpperCase();

      if (!ownerName || !ownerEmail || !libraryTitle) {
        setStatus("Please complete the required fields (Name, Email, Library Title).");
        return;
      }

      const designTemplate = (document.getElementById("designTemplate").value || "").trim();

      let theme = (document.getElementById("theme").value || "").trim();
      let primaryColor = (document.getElementById("primaryColor").value || "").trim();
      if (!theme) theme = DEFAULT_THEME;
      if (!primaryColor) primaryColor = DEFAULT_PRIMARY_COLOR;

      const familyIntro = (document.getElementById("familyIntro").value || "");
      const notes = (document.getElementById("notes").value || "");

      submitBtn.disabled = true;
      submitBtn.textContent = "Submitting...";
      setStatus("Submitting your request...");

      try {
        const payload = {
          ownerName,
          ownerEmail,
          libraryTitle,
          designTemplate: designTemplate || DEFAULT_DESIGN_TEMPLATE,
          theme,
          primaryColor,
          package: pkg,
          familyIntro,
          notes
        };

        const res = await fetch(WEBAPP_URL, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8" },
          body: toFormBody(payload)
        });

        let json;
        try {
          json = await res.json();
        } catch (e) {
          throw new Error("Server response was not JSON. Please confirm your Web App is deployed as 'Anyone' and returns JSON.");
        }

        if (!json || !json.ok) {
          throw new Error((json && json.error) ? json.error : "Submission failed.");
        }

        const pid = encodeURIComponent(json.projectId || "");
        const p = encodeURIComponent(pkg);
        window.location.href = `success.html?pid=${pid}&package=${p}`;

      } catch (err) {
        setStatus("Error: " + (err && err.message ? err.message : String(err)));
        submitBtn.disabled = false;
        submitBtn.textContent = "Submit Request";
      }
    });
  </script>
</body>
</html>
