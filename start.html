<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Start — TinyTeam</title>
  <meta name="description" content="Start your TinyTeam library. Submit the form to begin processing." />
  <link rel="stylesheet" href="assets/styles/main.css" />

  <!-- Small safety styles only (won’t change your layout) -->
  <style>
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,"Liberation Mono","Courier New", monospace;}
    .status{margin-top:10px;font-size:13px;color: rgba(0,0,0,0.65);display:none;line-height:1.5;}
    .status.show{display:block}
    .note{font-size:13px;color:rgba(0,0,0,0.65);line-height:1.6;margin-top:10px;}
    .autoPreview{margin-top:10px;padding:10px 12px;border:1px dashed rgba(0,0,0,0.16);border-radius:14px;background:#f8fafc;color:rgba(0,0,0,0.70);font-size:13px;line-height:1.6;}
  </style>
</head>

<body>

<header>
  <div>
    <a href="index.html"><strong>TinyTeam Digital Library</strong></a>
    <nav>
      <a href="index.html">Home</a>
      <a href="start.html">Start</a>
      <a href="help/index.html">Help</a>
    </nav>
  </div>
</header>

<main>

  <section class="panel">
    <h1>Start Your Library</h1>
    <p class="muted">
      Submit your request to begin manual review. TinyTeam is privacy-first and human-handled.
      We will email you next steps after review.
    </p>

    <form id="startForm" method="POST"
      action="https://script.google.com/macros/s/AKfycbzX7SG63XhVSPERvMDyZWT2AH9J7FGYleaTVUzXP2axrPVWcYpC-CGXBXGWa8QUoo7m_w/exec?key=TT_PRIVATE_2026_01">
      <input type="hidden" name="formType" value="START">

      <!-- IDs -->
      <!-- IMPORTANT: This is your RequestID in the sheet -->
      <input type="hidden" name="RequestID" id="orderIdHidden" value="" />

      <div class="grid2">
        <div>
          <label>Full Name</label>
          <input name="OwnerName" type="text" placeholder="Full name (required)" required />
        </div>
        <div>
          <label>Email</label>
          <input name="OwnerEmail" type="email" placeholder="Email (required)" required />
        </div>
      </div>

      <div class="grid2" style="margin-top:12px;">
        <div>
          <label>Package</label>
          <select name="Package" id="packageSel" required>
            <option value="FAM">Family Library (FAM) — $48</option>
            <option value="COMM">Community Library (COMM) — $89</option>
            <option value="ADDON">Photos / Docs Add-On — $49</option>
          </select>
        </div>
        <div>
          <label>Order ID (auto-generated)</label>
          <input id="orderIdView" class="mono" type="text" readonly />
          <p class="muted small" style="margin:6px 0 0;">Keep this Order ID for payment proof + follow-ups.</p>
        </div>
      </div>

      <!-- Design (auto resolver, same behavior you already had) -->
      <div class="grid3" style="margin-top:12px;">
        <div>
          <label>Design Template</label>
          <select name="design_template" id="designSel">
            <option value="">Auto (recommended)</option>
            <option value="DESIGN_01">DESIGN_01</option>
            <option value="DESIGN_02">DESIGN_02</option>
            <option value="DESIGN_03">DESIGN_03</option>
            <option value="DESIGN_04">DESIGN_04</option>
            <option value="DESIGN_05">DESIGN_05</option>
            <option value="DESIGN_06">DESIGN_06</option>
          </select>
        </div>
        <div>
          <label>Theme</label>
          <select name="theme" id="themeSel">
            <option value="">Auto (recommended)</option>
            <option value="Classic">Classic</option>
            <option value="Modern">Modern</option>
            <option value="Minimal">Minimal</option>
            <option value="Warm">Warm</option>
            <option value="Elegant">Elegant</option>
          </select>
        </div>
        <div>
          <label>Primary Color</label>
          <select name="primary_color" id="colorSel">
            <option value="">Auto (recommended)</option>
            <option value="#2563eb">Blue</option>
            <option value="#16a34a">Green</option>
            <option value="#111827">Neutral</option>
            <option value="#a855f7">Purple</option>
            <option value="#f59e0b">Warm (Gold)</option>
            <option value="#0ea5e9">Sky</option>
          </select>
        </div>
      </div>

      <!-- Resolved fields that system should trust -->
      <input type="hidden" name="DesignResolved" id="designResolved" value="" />
      <input type="hidden" name="ThemeResolved"  id="themeResolved"  value="" />
      <input type="hidden" name="ColorResolved"  id="colorResolved"  value="" />

      <div class="autoPreview" id="autoPreview">Auto selection: <strong>—</strong></div>

      <div style="margin-top:14px;display:flex;gap:12px;flex-wrap:wrap;">
        <button class="btn" id="submitBtn" type="submit">Submit Request</button>
        <a class="btn secondary" id="payBtn" href="payment.html">View Payment Options</a>
      </div>

      <p class="note">
        Please wait for approval email before paying. This button only shows payment methods.
      </p>

      <div class="status" id="statusBox">Submitting your request…</div>
    </form>
  </section>

</main>

<footer class="site-footer">
  <div class="footer-inner">
    <div class="footer-brand">
      <img class="footer-logo" src="assets/logo/tinyteam-logo.jpeg" alt="TinyTeam Digital Library" />
      <span class="footer-x">×</span>
      <img class="footer-logo" src="assets/logo/svp-funnels-logo.png" alt="SVP Funnels" />
    </div>

    <div class="footer-contacts">
      <a href="mailto:chinveloso.consmaterials@gmail.com">chinveloso.consmaterials@gmail.com</a>
      <span class="dot">•</span>
      <a href="mailto:smallsteps@tinyteamstudio.online">smallsteps@tinyteamstudio.online</a>
    </div>

    <div class="footer-links">
      <a href="index.html">Home</a>
      <span class="dot">•</span>
      <a href="help/index.html">Help</a>
      <span class="dot">•</span>
      <a href="reseller/index.html">Reseller Program</a>
    </div>

    <div class="footer-links" style="margin-top:6px;">
      <a href="https://www.facebook.com/profile.php?id=61585335397502" target="_blank" rel="noopener">
        TinyTeam Digital Library (Facebook)
      </a>
      <span class="dot">•</span>
      <a href="https://www.facebook.com/profile.php?id=61571330212081" target="_blank" rel="noopener">
        SVP Digital System (Facebook)
      </a>
      <span class="dot">•</span>
      <a href="https://www.facebook.com/svpfunnels" target="_blank" rel="noopener">
        Chin Veloso (Facebook)
      </a>
    </div>
  </div>
</footer>

<script>
(function(){
  const params = new URLSearchParams(window.location.search);

  const pkgSel = document.getElementById("packageSel");
  const orderIdView = document.getElementById("orderIdView");
  const orderIdHidden = document.getElementById("orderIdHidden");
  const startNext = document.getElementById("startNext");
  const payBtn = document.getElementById("payBtn");

  const designSel = document.getElementById("designSel");
  const themeSel  = document.getElementById("themeSel");
  const colorSel  = document.getElementById("colorSel");
  const designResolved = document.getElementById("designResolved");
  const themeResolved  = document.getElementById("themeResolved");
  const colorResolved  = document.getElementById("colorResolved");
  const autoPreview    = document.getElementById("autoPreview");

  const pkgFromUrl = (params.get("package") || "").toUpperCase();
  if (pkgSel && (pkgFromUrl === "FAM" || pkgFromUrl === "COMM" || pkgFromUrl === "ADDON")) {
    pkgSel.value = pkgFromUrl;
  }

  let rid = (params.get("order_id") || "").trim();

  function pad6(n){
    const s = String(n);
    return s.length >= 6 ? s.slice(-6) : ("000000" + s).slice(-6);
  }

  function makeOrderId(){
    const now = new Date();
    const year = now.getFullYear();
    const seconds = Math.floor(now.getTime() / 1000);
    const six = seconds % 1000000;

    const alphabet = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
    let suffix = "";
    for (let i = 0; i < 3; i++) suffix += alphabet[Math.floor(Math.random() * alphabet.length)];

    return `TT-ORD-${year}-${pad6(six)}-${suffix}`;
  }

  if (!rid) rid = makeOrderId();

  if (orderIdView) orderIdView.value = rid;
  if (orderIdHidden) orderIdHidden.value = rid;

  try{
    localStorage.setItem("TT_LAST_ORDER_ID", rid);
    localStorage.setItem("TT_LAST_PACKAGE", (pkgSel ? (pkgSel.value||"FAM") : "FAM").toUpperCase());
  }catch(e){}

  function hashStr(str){
    let h = 0;
    for (let i = 0; i < str.length; i++) {
      h = ((h << 5) - h) + str.charCodeAt(i);
      h |= 0;
    }
    return Math.abs(h);
  }

  function pick(arr, seed){ return arr[seed % arr.length]; }

  function labelForColor(val){
    const map = {
      "#2563eb":"Blue",
      "#16a34a":"Green",
      "#111827":"Neutral (Black/Gray)",
      "#a855f7":"Purple",
      "#f59e0b":"Warm (Gold)",
      "#0ea5e9":"Sky"
    };
    return map[val] || val;
  }

  function resolveAutoDesign(){
    const seedBase = hashStr(rid + "|" + (pkgSel ? pkgSel.value : "FAM"));

    const designOptions = ["DESIGN_01","DESIGN_02","DESIGN_03","DESIGN_04","DESIGN_05","DESIGN_06"];
    const themeOptions  = ["Classic","Modern","Minimal","Warm","Elegant"];
    const colorOptions  = ["#2563eb","#16a34a","#111827","#a855f7","#f59e0b","#0ea5e9"];

    const chosenDesign = (designSel && designSel.value) ? designSel.value : pick(designOptions, seedBase);
    const chosenTheme  = (themeSel  && themeSel.value)  ? themeSel.value  : pick(themeOptions,  seedBase + 7);
    const chosenColor  = (colorSel  && colorSel.value)  ? colorSel.value  : pick(colorOptions,  seedBase + 13);

    if (designResolved) designResolved.value = chosenDesign;
    if (themeResolved)  themeResolved.value  = chosenTheme;
    if (colorResolved)  colorResolved.value  = chosenColor;

    if (autoPreview) {
      const autoOn = (!designSel.value) && (!themeSel.value) && (!colorSel.value);
      const modeText = autoOn ? "Auto selection" : "Your selection";
      autoPreview.innerHTML = `${modeText}: <strong>${chosenDesign.replace("_"," ")}</strong> • <strong>${chosenTheme}</strong> • <strong>${labelForColor(chosenColor)}</strong>`;
    }
  }

  function syncLinks(){
    const pkg = (pkgSel ? (pkgSel.value || "FAM") : "FAM").toUpperCase();
    const encodedPkg = encodeURIComponent(pkg);
    const encodedId  = encodeURIComponent(rid);

    if (payBtn) payBtn.href = `payment.html?package=${encodedPkg}&order_id=${encodedId}`;
    if (startNext) startNext.value = `https://tinyteamstudio.online/thank-you.html?from=start&package=${encodedPkg}&order_id=${encodedId}`;

    try{
      localStorage.setItem("TT_LAST_ORDER_ID", rid);
      localStorage.setItem("TT_LAST_PACKAGE", pkg);
    }catch(e){}

    resolveAutoDesign();
  }

  if (pkgSel)   pkgSel.addEventListener("change", syncLinks);
  if (designSel)designSel.addEventListener("change", resolveAutoDesign);
  if (themeSel) themeSel.addEventListener("change", resolveAutoDesign);
  if (colorSel) colorSel.addEventListener("change", resolveAutoDesign);

  syncLinks();
  resolveAutoDesign();

  const form = document.getElementById("startForm");
  if (form) form.addEventListener("submit", resolveAutoDesign);
})();
(function(){
  const form = document.getElementById("startForm");
  const btn  = document.getElementById("submitBtn");
  const box  = document.getElementById("statusBox");
  if (!form || !btn || !box) return;

  form.addEventListener("submit", () => {
    btn.disabled = true;
    btn.textContent = "Submitting...";
    box.classList.add("show");
  });
})();
</script>

</body>
</html>
